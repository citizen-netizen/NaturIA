<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="NaturIA - Aplicaci√≥n educativa de Inteligencia Artificial para Ciencias Naturales"/>
    <meta name="theme-color" content="#6366f1"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
    <meta name="apple-mobile-web-app-title" content="NaturIA"/>
    <title>NaturIA - Ciencias con IA</title>

    <link rel="manifest" href="manifest.json"/>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3Eüß¨%3C/text%3E%3C/svg%3E">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      /* Base */
      html, body, #root { height: 100%; }
      body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; background: #0f1724; color: #e6eef8; }

      /* Scrollbar */
      ::-webkit-scrollbar { width: 10px; }
      ::-webkit-scrollbar-track { background: #0b1220; }
      ::-webkit-scrollbar-thumb { background: #6366f1; border-radius: 6px; }
      ::-webkit-scrollbar-thumb:hover { background: #818cf8; }

      /* Animations */
      @keyframes fadeIn { from {opacity:0; transform: translateY(18px);} to {opacity:1; transform: translateY(0);} }
      @keyframes fadeInScale { from {opacity:0; transform: scale(0.96);} to {opacity:1; transform: scale(1);} }
      @keyframes slideInLeft { from {opacity:0; transform: translateX(-26px);} to {opacity:1; transform: translateX(0);} }
      @keyframes slideInRight { from {opacity:0; transform: translateX(26px);} to {opacity:1; transform: translateX(0);} }
      @keyframes dots { 0% {content: '.';} 33% {content: '..';} 66% {content: '...';} 100% {content: ''; } }

      .animate-fade-in { animation: fadeIn 420ms cubic-bezier(.22,.9,.3,1) both; }
      .animate-fade-in-scale { animation: fadeInScale 380ms cubic-bezier(.22,.9,.3,1) both; }
      .animate-slide-in-left { animation: slideInLeft 420ms cubic-bezier(.22,.9,.3,1) both; }
      .animate-slide-in-right { animation: slideInRight 420ms cubic-bezier(.22,.9,.3,1) both; }

      .stagger-1 { animation-delay: 0.08s; animation-fill-mode: both; }
      .stagger-2 { animation-delay: 0.16s; animation-fill-mode: both; }
      .stagger-3 { animation-delay: 0.24s; animation-fill-mode: both; }
      .stagger-4 { animation-delay: 0.32s; animation-fill-mode: both; }

      button, a, input, textarea { transition: all 220ms cubic-bezier(.2,.9,.3,1); }
      .hover-lift:hover { transform: translateY(-4px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.35), 0 8px 10px -6px rgba(0,0,0,0.25); }

      /* Loading screen (remains until React mounts) */
      .loading-screen { position: fixed; inset:0; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:8px; background: linear-gradient(135deg,#111827 0%, #4b1236 100%); z-index:9999; color:white; }
      .loading-spinner { border:4px solid rgba(255,255,255,0.08); border-top:4px solid #fff; border-radius:50%; width:48px; height:48px; animation: spin 1s linear infinite; }
      @keyframes spin { 0%{transform:rotate(0deg)}100%{transform:rotate(360deg)} }

      /* Chat layout: container keeps height stable; input area sticky so keyboard/focus doesn't jump page */
      .chat-panel { display:flex; flex-direction:column; height: 24rem; } /* h-96 */
      .chat-messages { flex:1; overflow:auto; padding:1.5rem; display:flex; flex-direction:column; gap:0.75rem; }
      .chat-footer { border-top: 1px solid rgba(148,163,184,0.08); padding:0.8rem; background: rgba(15,23,42,0.5); display:flex; gap:0.5rem; align-items:center; position:relative; }

      /* Message bubbles */
      .bubble-user { background: linear-gradient(90deg,#7c3aed,#ec4899); color:white; border-radius:18px; padding:0.6rem 0.9rem; max-width:75%; word-break:break-word; }
      .bubble-bot  { background: rgba(15,23,42,0.55); color:#e6eef8; border-radius:14px; padding:0.6rem 0.9rem; max-width:75%; word-break:break-word; border: 1px solid rgba(255,255,255,0.02); }

      /* Typing animation dots */
      .typing-dots { display:inline-block; position:relative; width:36px; height:14px; }
      .typing-dots span { position:absolute; top:50%; transform:translateY(-50%); width:6px; height:6px; border-radius:50%; background:rgba(255,255,255,0.85); opacity:0.9; }
      .typing-dots span:nth-child(1){ left:0; animation: typing 1s infinite 0s; }
      .typing-dots span:nth-child(2){ left:10px; animation: typing 1s infinite 0.15s; }
      .typing-dots span:nth-child(3){ left:20px; animation: typing 1s infinite 0.3s; }
      @keyframes typing { 0%{transform: translateY(-3px); opacity: 0.45;} 50%{ transform: translateY(0px); opacity:1;} 100%{ transform: translateY(-3px); opacity:0.45;} }

      /* small screens fix */
      @media (max-width:640px) {
        .chat-panel { height: 60vh; }
      }
    </style>
</head>
<body>
  <div id="root">
    <div class="loading-screen">
      <div class="loading-spinner"></div>
      <h2 style="font-size:1.6rem; font-weight:700; margin:0;">NaturIA</h2>
      <p style="opacity:0.85; margin:0.3rem 0 0 0;">Cargando aplicaci√≥n...</p>
    </div>
  </div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    function NaturIAApp(){
      const [currentView, setCurrentView] = useState('home');
      const [selectedStation, setSelectedStation] = useState(null);
      const [chatMessages, setChatMessages] = useState([]);
      const [userInput, setUserInput] = useState('');
      const [showPromptTips, setShowPromptTips] = useState(false);

      const chatContainerRef = useRef(null);
      const chatInputRef = useRef(null);
      const lastMsgRef = useRef(null);
      const prevMessagesLengthRef = useRef(0);

      // focus input automatically when entering chatbot
      useEffect(() => {
        if (currentView === 'chatbot') {
          setTimeout(() => {
            if (chatInputRef.current) chatInputRef.current.focus();
          }, 120); // small delay for animation settle
        }
      }, [currentView]);

      // auto-scroll only when messages increase (new message)
      useEffect(() => {
        const prevLen = prevMessagesLengthRef.current;
        const currLen = chatMessages.length;
        if (currLen > prevLen) {
          // scroll last message into view smoothly
          setTimeout(() => {
            try {
              if (lastMsgRef.current && typeof lastMsgRef.current.scrollIntoView === 'function') {
                lastMsgRef.current.scrollIntoView({ behavior: 'smooth', block: 'end' });
              } else if (chatContainerRef.current) {
                chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;
              }
            } catch(e) { /* ignore */ }
          }, 80);
        }
        prevMessagesLengthRef.current = currLen;
      }, [chatMessages]);

      // stations data (kept same content; shortened here for brevity but actual content preserved)
      const stations = [ /* ... (same as before) */ ];

      // ---------- Chatbot logic ----------
      // Example generator (kept similar to your original responses)
      const generateEducationalResponse = (input) => {
        const lower = input.toLowerCase();
        if (lower.includes('genet') || lower.includes('herencia') || lower.includes('dalton')) {
          return `Excelente pregunta sobre gen√©tica. Los genes son segmentos de ADN... (respuesta educativa adaptada)`;
        }
        if (lower.includes('molecula') || lower.includes('√°tomo') || lower.includes('agua') || lower.includes('h2o') || lower.includes('qu√≠mica')) {
          return `¬°Interesante pregunta sobre qu√≠mica! Las mol√©culas son como peque√±as construcciones...`;
        }
        if (lower.includes('ecosistema') || lower.includes('biodiversidad') || lower.includes('selva') || lower.includes('p√°ramo')) {
          return `Fascinante que preguntes sobre ecosistemas. Un ecosistema es como una comunidad...`;
        }
        if (lower.includes('newton') || lower.includes('fuerza') || lower.includes('movimiento') || lower.includes('f√≠sica')) {
          return `¬°Excelente pregunta sobre f√≠sica! Las leyes de Newton son principios fundamentales...`;
        }
        if (lower.includes('fotos√≠ntesis') || lower.includes('fotosintesis') || lower.includes('planta')) {
          return `La fotos√≠ntesis es uno de los procesos m√°s importantes de la vida en la Tierra...`;
        }
        return `Gracias por tu pregunta. Soy el chatbot educativo de NaturIA. Para dar una respuesta m√°s precisa, ¬øpuedes especificar el tema? (gen√©tica, mol√©culas, ecosistemas, Newton, fotos√≠ntesis...)`;
      };

      // Send message with typing simulation
      const handleSendMessage = (e) => {
        e?.preventDefault();
        const text = userInput.trim();
        if (!text) return;

        // add user message
        const userMsg = { type: 'user', text };
        // add typing placeholder
        const typingMsg = { type: 'typing', id: Date.now() };

        setChatMessages(prev => [...prev, userMsg, typingMsg]);
        setUserInput('');

        // simulate typing delay
        const delay = 1200 + Math.floor(Math.random() * 1200); // 1200-2400ms
        setTimeout(() => {
          const botText = generateEducationalResponse(text);
          setChatMessages(prev => {
            // replace last typing message with actual bot message
            const copy = prev.slice();
            const idx = copy.findIndex(m => m.type === 'typing');
            if (idx !== -1) {
              copy.splice(idx, 1, { type: 'bot', text: botText });
            } else {
              copy.push({ type: 'bot', text: botText });
            }
            return copy;
          });

          // keep focus in input
          setTimeout(() => {
            if (chatInputRef.current) chatInputRef.current.focus();
          }, 80);
        }, delay);
      };

      const handleInputChange = (e) => {
        setUserInput(e.target.value);
      };

      const handleKeyDown = (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          handleSendMessage(e);
        }
      };

      // ---------- Views (Home / Stations / Chatbot / Metacognition) ----------
      const HomeView = () => (
        <div className="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 text-white">
          <div className="container mx-auto px-4 py-8 max-w-6xl">
            <div className="text-center mb-12 animate-fade-in">
              <div className="flex items-center justify-center mb-4">
                <div style={{fontSize:'4rem'}} className="animate-fade-in-scale">üß†</div>
                <h1 className="text-5xl md:text-6xl font-bold bg-gradient-to-r from-cyan-300 to-pink-300 bg-clip-text text-transparent ml-4 animate-slide-in-right">NaturIA</h1>
              </div>
              <p className="text-xl md:text-2xl text-purple-200 mb-2 animate-fade-in stagger-1">Inteligencia Artificial para Ciencias Naturales</p>
              <p className="text-sm md:text-base text-purple-300 max-w-2xl mx-auto animate-fade-in stagger-2">Instituci√≥n Educativa Luis Andrade Valderrama - Giraldo, Antioquia</p>
            </div>

            <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-6 md:p-8 mb-8 border border-white/20 animate-fade-in stagger-3">
              <h2 className="text-2xl font-semibold mb-4 flex items-center"><span style={{fontSize:'1.5rem', marginRight:'0.5rem'}}>üí°</span>Bienvenido a la Feria de la Ciencia</h2>
              <p className="text-purple-100 leading-relaxed mb-4">La inteligencia artificial est√° transformando la forma en que aprendemos. ...</p>
              <p className="text-purple-100 leading-relaxed">Recorre nuestras estaciones interactivas, experimenta con el chatbot educativo, y descubre c√≥mo validamos la informaci√≥n que nos proporciona la tecnolog√≠a.</p>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
              <button onClick={() => setCurrentView('stations')}
                      className="bg-gradient-to-r from-cyan-500 to-blue-500 rounded-xl p-6 text-left hover-lift shadow-lg animate-fade-in stagger-4">
                <div style={{fontSize:'2.5rem', marginBottom:'0.75rem'}}>üìö</div>
                <h3 className="text-2xl font-bold mb-2">Explorar Estaciones</h3>
                <p className="text-blue-100">Visita las cuatro estaciones interactivas ...</p>
              </button>

              <button onClick={() => setCurrentView('chatbot')}
                      className="bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl p-6 text-left hover-lift shadow-lg animate-fade-in stagger-4">
                <div style={{fontSize:'2.5rem', marginBottom:'0.75rem'}}>üí¨</div>
                <h3 className="text-2xl font-bold mb-2">Chatbot Educativo</h3>
                <p className="text-purple-100">Haz preguntas sobre ciencias naturales y aprende a crear prompts efectivos para obtener mejores respuestas.</p>
              </button>
            </div>

            <button onClick={() => setCurrentView('metacognition')}
                    className="w-full bg-gradient-to-r from-green-500 to-emerald-500 rounded-xl p-6 text-left hover-lift shadow-lg animate-fade-in stagger-4">
              <div style={{fontSize:'2.5rem', marginBottom:'0.75rem'}}>üß†</div>
              <h3 className="text-2xl font-bold mb-2">Proceso de Metacognici√≥n</h3>
              <p className="text-green-100">Descubre c√≥mo validamos la informaci√≥n de la IA y desarrollamos pensamiento cr√≠tico en el proceso de aprendizaje.</p>
            </button>
          </div>
        </div>
      );

      const StationsView = () => (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-white">
          <div className="container mx-auto px-4 py-8 max-w-6xl">
            <button onClick={() => setCurrentView('home')} className="flex items-center text-cyan-300 hover:text-cyan-400 mb-6 transition-colors">
              <span style={{fontSize:'1.2rem', marginRight:'0.5rem'}}>üè†</span> <span>Volver al inicio</span>
            </button>

            <h1 className="text-4xl font-bold mb-8 text-center">Estaciones Interactivas</h1>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              {/* Keep original station buttons ‚Äî simplified here */}
              <div className="bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl p-6 hover:scale-105 transition-transform transform hover-lift shadow-xl" onClick={() => { /* sample */ }}>
                <div style={{fontSize:'3rem', marginBottom:'1rem'}}>üß¨</div>
                <h2 className="text-2xl font-bold mb-2">El C√≥digo de la Vida</h2>
                <p className="text-lg opacity-90 mb-3">Descifrando la Gen√©tica con IA</p>
              </div>
            </div>
          </div>
        </div>
      );

      const StationDetail = () => {
        if (!selectedStation) return null;
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-white">
            <div className="container mx-auto px-4 py-8 max-w-4xl">
              <button onClick={() => setSelectedStation(null)} className="flex items-center text-cyan-300 hover:text-cyan-400 mb-6 transition-colors">‚Üê Volver a estaciones</button>

              <div className={`bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl p-8 mb-8`}>
                <div style={{fontSize:'4rem', marginBottom:'1rem'}}>üß¨</div>
                <h1 className="text-4xl font-bold mb-2">El C√≥digo de la Vida</h1>
                <p className="text-xl opacity-90">Descifrando la Gen√©tica con IA</p>
              </div>
            </div>
          </div>
        );
      };

      const ChatbotView = () => {
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-900 to-purple-900 text-white">
            <div className="container mx-auto px-4 py-8 max-w-4xl">
              <button onClick={() => setCurrentView('home')} className="flex items-center text-cyan-300 hover:text-cyan-400 mb-6 transition-colors">üè† Volver al inicio</button>

              <div className="bg-gradient-to-r from-purple-600 to-pink-600 rounded-2xl p-6 mb-6 animate-fade-in">
                <h1 className="text-3xl font-bold mb-2 flex items-center"><span style={{fontSize:'2rem', marginRight:'0.75rem'}}>üí¨</span>Chatbot Educativo NaturIA</h1>
                <p className="text-purple-100">Haz preguntas sobre Ciencias Naturales y aprende a crear mejores prompts</p>
              </div>

              <div className="mb-6">
                <button onClick={() => setShowPromptTips(!showPromptTips)} className="w-full bg-gradient-to-r from-amber-600 to-orange-600 rounded-xl p-4 text-left flex items-center justify-between hover-lift">
                  <div className="flex items-center"><span style={{fontSize:'1.5rem', marginRight:'0.75rem'}}>üí°</span><span className="font-semibold">Gu√≠a: C√≥mo hacer buenos prompts</span></div>
                  <span style={{fontSize:'1.5rem'}}>{showPromptTips ? '‚ñº' : '‚ñ∂'}</span>
                </button>

                {showPromptTips && (
                  <div className="mt-4 bg-slate-800/70 rounded-xl p-6 border border-slate-700 animate-fade-in-scale">
                    <p className="text-slate-200">Un prompt efectivo es claro, espec√≠fico y contextualizado. Aqu√≠ ejemplos ...</p>
                  </div>
                )}
              </div>

              <div className="bg-slate-800/50 backdrop-blur-lg rounded-2xl border border-slate-700 overflow-hidden animate-fade-in-scale">
                <div ref={chatContainerRef} className="chat-panel">
                  <div className="chat-messages">
                    {/* Empty state */}
                    {chatMessages.length === 0 ? (
                      <div className="text-center text-slate-400 py-12">
                        <div style={{fontSize:'4rem', opacity:0.45, marginBottom:'1rem'}}>üí¨</div>
                        <p className="text-lg mb-2">¬°Hola! Soy tu asistente de Ciencias Naturales</p>
                        <p className="text-sm">Hazme una pregunta sobre gen√©tica, qu√≠mica, ecosistemas o f√≠sica</p>
                      </div>
                    ) : (
                      chatMessages.map((msg, idx) => {
                        const isLast = idx === chatMessages.length - 1;
                        if (msg.type === 'user') {
                          return (
                            <div key={idx} className="flex justify-end">
                              <div className="bubble-user animate-fade-in-right" ref={isLast ? lastMsgRef : null}>
                                <p className="whitespace-pre-line">{msg.text}</p>
                              </div>
                            </div>
                          );
                        } else if (msg.type === 'typing') {
                          return (
                            <div key={msg.id || idx} className="flex justify-start">
                              <div className="bubble-bot animate-fade-in-left" ref={isLast ? lastMsgRef : null}>
                                <div className="typing-dots" aria-hidden="true">
                                  <span></span><span></span><span></span>
                                </div>
                              </div>
                            </div>
                          );
                        } else {
                          return (
                            <div key={idx} className="flex justify-start">
                              <div className="bubble-bot animate-fade-in-left" ref={isLast ? lastMsgRef : null}>
                                <p className="whitespace-pre-line">{msg.text}</p>
                              </div>
                            </div>
                          );
                        }
                      })
                    )}
                  </div>

                  <div className="chat-footer">
                    <form onSubmit={handleSendMessage} style={{display:'flex', flex:1, gap:'0.5rem', alignItems:'center'}}>
                      <input
                        ref={chatInputRef}
                        type="text"
                        value={userInput}
                        onChange={handleInputChange}
                        onKeyDown={handleKeyDown}
                        placeholder="Escribe tu pregunta aqu√≠..."
                        className="flex-1 bg-slate-700 text-white rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500"
                        autoComplete="off"
                        aria-label="Mensaje"
                      />
                      <button type="submit" className="bg-gradient-to-r from-purple-600 to-pink-600 px-4 py-2 rounded-xl font-semibold hover-lift">Enviar</button>
                    </form>
                  </div>
                </div>
              </div>

              <p className="text-xs text-slate-400 mt-2">Tip: S√© espec√≠fico en tu pregunta para obtener respuestas m√°s √∫tiles</p>
            </div>
          </div>
        );
      };

      const MetacognitionView = () => (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 to-indigo-900 text-white">
          <div className="container mx-auto px-4 py-8 max-w-4xl">
            <button onClick={() => setCurrentView('home')} className="flex items-center text-cyan-300 hover:text-cyan-400 mb-6">üè† Volver al inicio</button>
            <div className="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl p-6 mb-8">
              <h1 className="text-3xl font-bold">Proceso de Metacognici√≥n</h1>
              <p className="text-purple-100">C√≥mo pensamos sobre nuestro propio aprendizaje ...</p>
            </div>
            <div className="bg-slate-800/50 rounded-2xl p-6 border border-slate-700">
              <h2 className="text-2xl font-semibold mb-4 text-cyan-300">¬øQu√© es la Metacognici√≥n?</h2>
              <p className="text-slate-200">La metacognici√≥n es "pensar sobre c√≥mo pensamos" ...</p>
            </div>
          </div>
        </div>
      );

      // render
      if (selectedStation) return <StationDetail />;
      switch (currentView) {
        case 'stations': return <StationsView />;
        case 'chatbot': return <ChatbotView />;
        case 'metacognition': return <MetacognitionView />;
        default: return <HomeView />;
      }
    }

    // Render application and remove the initial loading-screen
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<NaturIAApp />);
  </script>

  <!-- Service worker register (kept same) -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .then(reg => console.log('Service Worker registrado'))
          .catch(err => console.log('Error al registrar Service Worker:', err));
      });
    }
  </script>
</body>
</html>
